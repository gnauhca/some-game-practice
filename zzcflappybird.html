<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>zzc flappybird</title>
<style>
*{margin:0; padding:0; font-family: impact;}
.none{display:none;}
#gamebox{position:relative; margin: 0 auto; margin-top:3%;  border:1px solid #333; overflow: hidden; background:#6CD4E1;}
.flappybg{position: absolute; z-index: 1; width:100%; height:85%; top:0;}
#bird{position: absolute; z-index: 20; width:6%; height:12%; left:20%; top:40%;}
#btmLine{position:absolute; height:15%; width:120%;  bottom:0;}
.pipe{position:absolute; z-index:10; width:8%; height:50%; left:10%;  background:#90CA5A; background: -webkit-gradient(linear,left top,right top,from(#518120), color-stop(0.34, #DCF582), color-stop(0.4, #E3FB89), color-stop(0.46, #DCF582),color-stop(0.7,#518120),to(#515D32)); box-shadow: inset 0px -8px 8px #333;}
.pipeSize{position: absolute; z-index: 11; width:120%; left:-10%; background:#234567;background: -webkit-gradient(linear,left top,right top,from(#518120),  color-stop(0.5, #DCF582),  color-stop(0.4, #E3FB89), color-stop(0.46, #DCF582),color-stop(0.7,#518120),to(#515D32)); box-shadow: inset 0px 0px 8px #333;}
.pipeTop{top:0; }
.pipeBtm{bottom:15%; box-shadow: inset 0px 8px 8px #333; }
.pipeTop .pipeSize{ bottom:0;}
.pipeBtm .pipeSize{ top:0;}
#score{position: absolute; z-index: 100; font-size: 300%; top:40%; left:60%; color: #fff; font-family: impact; text-shadow:0 0 5px #333; text-shadow:inset 0 0 2px #fff;}
#startBtn{position: absolute; z-index: 1000; width:10%; height:20%; top:40%; left:45%; border-radius: 10%; background: #fff; font-size: 400%; text-align: center; cursor:pointer; }
#retryBtn{position: absolute; z-index: 1000; width:10%; height:20%; top:40%; left:45%; border-radius: 10%; background: #fff; font-size: 400%; text-align: center; cursor:pointer; }

#gameoverBox{position: absolute;z-index: 1000; width:30%; height:15%; font-size: 100%;top:10%; left:35%; border-radius: 10%; background: #fff; font-size: 400%; text-align: center;}
</style>	
</head>
<body>
	<div id="outwrap" >
		<div id="gamebox">
			<img class="flappybg" src="pic/flappybg.jpg" >
			<img src="pic/bird.png" id="bird">
			<div id="score">0</div>
			<img id="btmLine" src="pic/flappybtm.jpg"/>


			<div class="none" id = "gameoverBox">
				<div id="gameover">Gameover</div>
			</div>

			<div id="startBtn" class="none">start</div>
			<div id="retryBtn" class="none">retry</div>

			<!--div class="pipe pipeTop">
				<div class="pipeSize"></div>
			</div>
			<div class="pipe pipeBtm">
				<div class="pipeSize"></div>
			</div-->
		</div>
	</div>

<script>
var gamebox = document.getElementById("gamebox");
var birdHitPipe = false;
var gameStart = false;

window.onresize =function(){ 
	setGameArea();
}
var setGameArea =function(){
	document.body.style.fontSize =  (document.documentElement.clientWidth||document.body.clientWidth)/100+"px";
	document.getElementById("gamebox").style.width = (document.documentElement.clientWidth||document.body.clientWidth)*0.8+"px";
	document.getElementById("gamebox").style.height = parseInt(document.documentElement.clientWidth||document.body.clientWidth)*0.4+"px";
	//console.log(document.documentElement.clientWidth||document.body.clientWidth+"px")
}
setGameArea();

/*birdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbirdbird*/
var Bird = function(){
	var speed = 0;
	var birdEle = document.getElementById("bird");
	var playing = false;
	var birdWidthPercent = 6;
	var birdHeightPercent = 12;


	this.getBirdInfo = function(){
		return {birdEle:birdEle,widthPercent:birdWidthPercent,heightpercent:birdHeightPercent};
	}

	this.init = function(){
		birdEle.style.top = "30%";
		birdEle.style["-webkit-transform"] = "rotate(0deg)";
		document.onclick = function(){
			if(!birdHitPipe)
			speed = -3;
		}
		document.onkeydown = function(event){
			var event = event||window.event;
			//event.preventDefault();
			if(!birdHitPipe)
			speed = -3;			
			//return false;
		}
	}

	this.clear = function(){}

	this.go =function(){
		if(!gameStart) return;
		speed+=0.28; //console.log(birdEle.style.top)
		birdEle.style.top = parseFloat(birdEle.style.top)+speed+"%";
		var angelF = (speed/5>1)?1:(speed/5);
		
		birdEle.style["-webkit-transform"] = "rotate("+angelF*90+"deg)";
	}
}
/*PIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPEPIPE PIPE PIPEPIPEPIPE*/
var Pipe = function(){
	var comingPipes = [];
	var passPipes = [];
	var actingPipe = null;
	var playing = false;
	var speed = 0.5;
	var pipeWidth = 8;

	function createPipe(){
		var pipeTop = document.createElement("div");
		var pipeBtm = document.createElement("div");
		var pipeTopHeightPercent = Math.ceil(Math.random()*30+8);
		var pipeBtmHeightPercent = 100 - pipeTopHeightPercent - 50;
		var pipeTopSizeHeightPercent = parseFloat((6/pipeTopHeightPercent)*100);
		var pipeBtmSizeHeightPercent = parseFloat((6/pipeBtmHeightPercent)*100);
		pipeTop.className = "pipe pipeTop";
		pipeTop.style.width = pipeWidth
		pipeTop.style.height = pipeTopHeightPercent+"%";
		pipeTop.style.left = "100%";

		pipeTop.innerHTML = "<div class='pipeSize' style='height:"+pipeTopSizeHeightPercent+"%'></div>";
		pipeBtm.className = "pipe pipeBtm";
		pipeBtm.style.width = pipeWidth
		pipeBtm.style.height = pipeBtmHeightPercent+"%";
		pipeBtm.style.left = "100%";
		pipeBtm.innerHTML = "<div class='pipeSize' style='height:"+pipeBtmSizeHeightPercent+"%'></div>";
		gamebox.appendChild(pipeTop);
		gamebox.appendChild(pipeBtm);
		return {"pipeTop":pipeTop,"pipeBtm":pipeBtm};
	}

	function createOrNot(){
		if(comingPipes.length==0) return true;
		//console.log(parseInt(comingPipes[comingPipes.length-1].pipeTop.style.left)+"<br>"+parseInt(comingPipes[comingPipes.length-1].pipeTop.clientWidth*6))
		if(parseFloat(comingPipes[comingPipes.length-1].pipeTop.style.left)<75){
			return true;
		}else{
			return false;
		}

	}

	//绠″瓙鍒嗙被
	function pipesClassify(){

		if(actingPipe!=null&&parseFloat(actingPipe.pipeTop.style.left)<20-pipeWidth){
			//actingPipe.pipeTop.style.background = "yellow";
			passPipes.push(actingPipe);
			actingPipe=null;			
			score.innerHTML = parseInt(score.innerHTML)+1;
		}

		if(parseFloat(comingPipes[0].pipeTop.style.left)<20+6){
			actingPipe = comingPipes.shift();
			//actingPipe.pipeTop.style.background = "red";
		}



		for(var i = 0; i<passPipes.length; i++){ 
			if(parseFloat(passPipes[i].pipeTop.style.left) < 0-pipeWidth){
				//passPipes[i].pipeTop.parentNode.removeChild(passPipes[i].pipeTop); 
				//passPipes[i].pipeBtm.parentNode.removeChild(passPipes[i].pipeBtm);
				delPipe(passPipes[i]);
				passPipes.splice(i,1);
			}
		}

	}

	//move everypipe
	function movePipe(pipeObj){
		pipeObj.pipeTop.style.left = parseFloat(pipeObj.pipeTop.style.left)-speed+"%";
		pipeObj.pipeBtm.style.left = parseFloat(pipeObj.pipeBtm.style.left)-speed+"%";
	}

	//delete pipe
	function delPipe(pipeObj){
		pipeObj.pipeTop.parentNode.removeChild(pipeObj.pipeTop); 
		pipeObj.pipeBtm.parentNode.removeChild(pipeObj.pipeBtm); 
	}

	this.getActingPipe = function(){
		return actingPipe;
	}

	this.init = function(){
		for(var i=0;i<comingPipes.length;i++){
			delPipe(comingPipes[i]);
			comingPipes[i] = null;
		}
		for(var i=0;i<passPipes.length;i++){
			delPipe(passPipes[i]);
			passPipes[i] = null;
		}
		comingPipes.length = 0;
		passPipes.length = 0;
		actingPipe&&delPipe(actingPipe);

	}

	this.clear = function(){}

	this.go = function(){
		if(!gameStart||birdHitPipe) return;
		if(createOrNot()){
		    comingPipes[comingPipes.length] = createPipe();
		}
		for(var i=0; i<comingPipes.length; i++){
			//console.log(comingPipes[i].pipeTop.style.left+"   "+ speed)
			movePipe(comingPipes[i])
		}
		for(var i=0; i<passPipes.length; i++){
			//console.log(passPipes[i].pipeTop.style.left+"   "+ speed)
			movePipe(passPipes[i])
		}

		actingPipe&&movePipe(actingPipe);
		pipesClassify();


	}


}




/*btmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmlinebtmline*/
var BtmLine = function(){
	var btmLineEle = document.getElementById("btmLine");
	var speed = 0;
	this.init = function(){
		btmLineEle.style.left = 0;
	}
	this.go = function(){
		if(birdHitPipe) return;
		speed = btmLineEle.clientWidth*0.0047;
		//console.log(btmLineEle.clientWidth+" left "+btmLineEle.style.left)
		if(Math.abs(parseInt(btmLineEle.style.left)-speed)>=btmLineEle.clientWidth*0.01871){
			btmLineEle.style.left = 0;
		}else{
			btmLineEle.style.left = parseInt(btmLineEle.style.left)-speed+"px";
		}
	}
}



/*gamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandlergamehandler*/
var gameHandler = {
	startBtn : document.getElementById("startBtn"),
	retryBtn : document.getElementById("retryBtn"),
	gameoverBox : document.getElementById("gameoverBox"),
	gameObjs : {bird:new Bird(),pipe:new Pipe(),btmLine : new BtmLine()},
	GameT : 0,
	init : function(){
		//this.bindingEvent();
			birdHitPipe = false;
		document.getElementById("score").innerHTML = 0;
		this.startBtn.style.display = "block";
		for(var i in this.gameObjs){
			this.gameObjs[i].init();
		}
		this.startMove();
	},
	bindingEvent : function(){
		var that = this;
		this.startBtn.onclick = function(){
			//stopMove();
			//init();
			gameStart = true;
			this.style.display = "none";
		}
		this.retryBtn.onclick = function(){
			that.gameoverBox.style.display = "none";
			this.style.display = "none";
			that.init();
			//this.startMove();
		}
	},	
	startMove : function(){
		var that = this;//dd
		this.GameT = setInterval(function(){
			for(var i in that.gameObjs){
				that.gameObjs[i].go();
				gameStart&&that.isDie();
			}
		},30);
	},
	stopMove :function(){
		clearInterval(this.GameT);
	},
	isDie : function(){
		birdInfo = this.gameObjs.bird.getBirdInfo();
		actingPipe = this.gameObjs.pipe.getActingPipe();
		if(parseFloat(birdInfo.birdEle.style.top)>85-birdInfo.heightpercent){
			this.stopMove(); gameStart = false; birdHitPipe||this.gameover();
		}else if(actingPipe!=null){
			if(parseFloat(birdInfo.birdEle.style.top)<parseFloat(actingPipe.pipeTop.style.height)){
				birdHitPipe = true; this.gameover();
			}
			if(parseFloat(birdInfo.birdEle.style.top)+birdInfo.heightpercent>100-parseFloat(actingPipe.pipeBtm.style.height)-15){
				
				 birdHitPipe = true; this.gameover();
			}
		}
	},
	startGame : function(){},
	pauseGame : function(){},
	gameover : function(){
		this.gameoverBox.style.display = "block";
		this.retryBtn.style.display = "block";
	}
}
gameHandler.bindingEvent();
gameHandler.init();
</script>

</body>
</html>
